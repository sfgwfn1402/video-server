# ğŸ—ï¸ Video Server æ¶æ„å¿«é€ŸæŒ‡å—

## ğŸ“ é¡¹ç›®ç»“æ„æ€»è§ˆ

```
video-server/
â”œâ”€â”€ ğŸš€ src/main.rs                    # åº”ç”¨å¯åŠ¨å…¥å£ (23è¡Œ)
â”œâ”€â”€ âš™ï¸ src/config.rs                  # é…ç½®ç®¡ç†æ¨¡å— (Spring Booté£æ ¼)
â”œâ”€â”€ ğŸ“¡ src/api/                       # APIå±‚ - HTTPè¯·æ±‚å¤„ç†
â”‚   â”œâ”€â”€ mod.rs                        # APIæ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ handlers.rs                   # ä¸šåŠ¡å¤„ç†å‡½æ•°
â”‚   â””â”€â”€ middleware.rs                 # ä¸­é—´ä»¶ (å¹¶å‘ç›‘æ§)
â”œâ”€â”€ ğŸ“Š src/models/                    # æ•°æ®æ¨¡å‹å±‚
â”‚   â”œâ”€â”€ mod.rs                        # æ¨¡å‹å¯¼å‡º
â”‚   â”œâ”€â”€ app_state.rs                  # åº”ç”¨çŠ¶æ€
â”‚   â”œâ”€â”€ requests.rs                   # è¯·æ±‚æ•°æ®ç»“æ„
â”‚   â””â”€â”€ responses.rs                  # å“åº”æ•°æ®ç»“æ„
â”œâ”€â”€ ğŸ¥ src/services/                  # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ mod.rs                        # æœåŠ¡å¯¼å‡º
â”‚   â”œâ”€â”€ video/                        # è§†é¢‘å¤„ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ mod.rs                    # è§†é¢‘æ¨¡å—å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ snapshot.rs               # è§†é¢‘æˆªå›¾æœåŠ¡ (æ ¸å¿ƒ)
â”‚   â”‚   â””â”€â”€ stream_handler.rs         # æµå¤„ç†å™¨ (å¤šåè®®æ”¯æŒ)
â”‚   â””â”€â”€ notification/                 # é€šçŸ¥æœåŠ¡
â”‚       â”œâ”€â”€ mod.rs                    # é€šçŸ¥æ¨¡å—å¯¼å‡º
â”‚       â””â”€â”€ feishu.rs                 # é£ä¹¦é€šçŸ¥é›†æˆ
â”œâ”€â”€ ğŸ”§ src/utils/                     # å·¥å…·å‡½æ•°å±‚
â”‚   â”œâ”€â”€ mod.rs                        # å·¥å…·å¯¼å‡º
â”‚   â”œâ”€â”€ image.rs                      # å›¾åƒå¤„ç†å·¥å…·
â”‚   â””â”€â”€ system.rs                     # ç³»ç»Ÿä¿¡æ¯å·¥å…·
â”œâ”€â”€ ğŸŒ frontend/vue-project/          # Vue.jså‰ç«¯
â””â”€â”€ ğŸ“‹ config.env.example             # é…ç½®ç¤ºä¾‹
```

## ğŸ”„ æ•°æ®æµå‘å›¾

```
HTTPè¯·æ±‚ â†’ APIå±‚ â†’ æœåŠ¡å±‚ â†’ å·¥å…·å±‚
    â†“        â†“       â†“       â†“
ä¸­é—´ä»¶ç›‘æ§  å¤„ç†å™¨   FFmpeg  ç³»ç»Ÿè°ƒç”¨
    â†“        â†“       â†“       â†“
å¹¶å‘ç»Ÿè®¡   ä¸šåŠ¡é€»è¾‘  è§†é¢‘å¤„ç†  æ–‡ä»¶æ“ä½œ
    â†“        â†“       â†“       â†“
çŠ¶æ€æ›´æ–°   å“åº”æ„å»º  ç»“æœè¾“å‡º  èµ„æºç®¡ç†
```

## ğŸ¯ æ ¸å¿ƒç»„ä»¶é€Ÿè§ˆ

### ğŸš€ å¯åŠ¨æµç¨‹ (main.rs)
```rust
VideoServerApp::create()                 // 1. åˆ›å»ºåº”ç”¨æ„å»ºå™¨
    .with_config(AppConfig::from_env())   // 2. åŠ è½½ç¯å¢ƒé…ç½®
    .init_environment()                   // 3. åˆå§‹åŒ–ç¯å¢ƒ
    .build()                             // 4. æ„å»ºåº”ç”¨
    .run()                               // 5. å¯åŠ¨æœåŠ¡å™¨
```

### âš™ï¸ é…ç½®ç³»ç»Ÿ (config.rs)
- **AppConfig**: åº”ç”¨é…ç½® (ç«¯å£ã€ç›®å½•ç­‰)
- **AppBuilder**: æ„å»ºå™¨æ¨¡å¼ (åƒSpring Boot)
- **VideoServerApp**: ä¸»åº”ç”¨ç±»
- **ç¯å¢ƒå˜é‡æ”¯æŒ**: SERVER_PORT, CLIPS_DIRç­‰

### ğŸ“¡ APIå±‚æ¶æ„
```rust
/api/hello          â†’ å¥åº·æ£€æŸ¥
/api/snapshot       â†’ è§†é¢‘æˆªå›¾ (POST)
/api/clip          â†’ è§†é¢‘å‰ªè¾‘ (POST)
/api/concurrent    â†’ å¹¶å‘ç»Ÿè®¡ (GET)
/api/system-stats  â†’ ç³»ç»Ÿç›‘æ§ (GET)
/clips/*           â†’ é™æ€æ–‡ä»¶æœåŠ¡
```

### ğŸ¥ æ ¸å¿ƒä¸šåŠ¡æœåŠ¡

#### VideoSnapshotService (è§†é¢‘æˆªå›¾)
```rust
// æ”¯æŒå¤šç§åè®®
RTSP: rtsp://camera/stream
RTMP: rtmp://live/stream  
HLS:  http://server/playlist.m3u8
HTTP: http://server/video.mp4

// æ™ºèƒ½å‚æ•°é€‚é…
realmonitoræ‘„åƒå¤´ â†’ ç®€åŒ–å‚æ•°
æ™®é€šæµåª’ä½“     â†’ å®Œæ•´å‚æ•°
```

#### éŸ³é¢‘è½¬ç å¤„ç†
```rust
pcm_alaw â†’ aac (è‡ªåŠ¨æ£€æµ‹è½¬æ¢)
è®¾ç½®æ¯”ç‰¹ç‡: 128kbps
å®¹å™¨å…¼å®¹: MP4æ ¼å¼
```

## ğŸ› ï¸ å…³é”®æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç”¨é€” |
|------|------|------|
| **Webæ¡†æ¶** | Axum | HTTPæœåŠ¡å™¨ |
| **å¼‚æ­¥è¿è¡Œæ—¶** | Tokio | å¼‚æ­¥å¤„ç† |
| **è§†é¢‘å¤„ç†** | FFmpeg | è§†é¢‘æˆªå›¾/å‰ªè¾‘ |
| **å¹¶å‘æ§åˆ¶** | AtomicUsize | è¯·æ±‚è®¡æ•° |
| **é…ç½®ç®¡ç†** | dotenv | ç¯å¢ƒå˜é‡ |
| **æ—¥å¿—ç³»ç»Ÿ** | tracing | ç»“æ„åŒ–æ—¥å¿— |
| **å‰ç«¯** | Vue.js | ç”¨æˆ·ç•Œé¢ |

## âš¡ å¿«é€Ÿå®šä½ä»£ç 

### æƒ³è¦ä¿®æ”¹APIæ¥å£ï¼Ÿ
ğŸ‘‰ `src/api/handlers.rs` - æ‰€æœ‰APIå¤„ç†å‡½æ•°

### æƒ³è¦æ·»åŠ æ–°çš„è§†é¢‘æ ¼å¼æ”¯æŒï¼Ÿ 
ğŸ‘‰ `src/services/video/snapshot.rs` - ä¿®æ”¹FFmpegå‚æ•°

### æƒ³è¦æ”¹å˜æœåŠ¡å™¨é…ç½®ï¼Ÿ
ğŸ‘‰ `src/config.rs` - é…ç½®ç®¡ç†
ğŸ‘‰ `config.env.example` - ç¯å¢ƒå˜é‡

### æƒ³è¦æ·»åŠ æ–°çš„é€šçŸ¥æ–¹å¼ï¼Ÿ
ğŸ‘‰ `src/services/notification/` - æ–°å»ºé€šçŸ¥æœåŠ¡

### æƒ³è¦ä¿®æ”¹å‰ç«¯ç•Œé¢ï¼Ÿ
ğŸ‘‰ `frontend/vue-project/src/` - Vueç»„ä»¶

## ğŸ” ä»£ç é˜…è¯»é¡ºåºå»ºè®®

### ç¬¬ä¸€éï¼šç†è§£æ¶æ„ (10åˆ†é’Ÿ)
1. `src/main.rs` - çœ‹åº”ç”¨å¦‚ä½•å¯åŠ¨
2. `src/config.rs` - ç†è§£é…ç½®ç³»ç»Ÿ  
3. `src/models/app_state.rs` - äº†è§£åº”ç”¨çŠ¶æ€

### ç¬¬äºŒéï¼šæ ¸å¿ƒä¸šåŠ¡ (20åˆ†é’Ÿ)
1. `src/api/handlers.rs` - APIæ¥å£é€»è¾‘
2. `src/services/video/snapshot.rs` - è§†é¢‘å¤„ç†æ ¸å¿ƒ
3. `src/api/middleware.rs` - å¹¶å‘æ§åˆ¶

### ç¬¬ä¸‰éï¼šå®Œæ•´åŠŸèƒ½ (30åˆ†é’Ÿ)
1. `src/services/video/stream_handler.rs` - å¤šåè®®æ”¯æŒ
2. `src/utils/` - å·¥å…·å‡½æ•°
3. `src/services/notification/` - é€šçŸ¥æœåŠ¡

## ğŸ§ª å¿«é€Ÿæµ‹è¯•æŒ‡å—

```bash
# 1. å¯åŠ¨æœåŠ¡å™¨
cargo run

# 2. æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:3000/api/hello

# 3. æµ‹è¯•ç³»ç»ŸçŠ¶æ€
curl http://localhost:3000/api/system-stats

# 4. æµ‹è¯•è§†é¢‘æˆªå›¾ (éœ€è¦çœŸå®è§†é¢‘æµ)
curl -X POST http://localhost:3000/api/snapshot \
  -H "Content-Type: application/json" \
  -d '{"url":"rtsp://your-camera/stream","timestamp":10.0}'
```

## ğŸ¨ è®¾è®¡æ¨¡å¼åº”ç”¨

- **Builderæ¨¡å¼**: AppBuilderæ„å»ºåº”ç”¨
- **Serviceæ¨¡å¼**: ä¸šåŠ¡é€»è¾‘åˆ†å±‚
- **Middlewareæ¨¡å¼**: è¯·æ±‚æ‹¦æˆªå¤„ç†
- **Factoryæ¨¡å¼**: StreamHandleråˆ›å»º
- **Strategyæ¨¡å¼**: ä¸åŒåè®®å¤„ç†ç­–ç•¥

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–ç‚¹

- **å¼‚æ­¥å¤„ç†**: Tokio + Axumå¼‚æ­¥æ¡†æ¶
- **å¹¶å‘æ§åˆ¶**: AtomicUsizeåŸå­è®¡æ•°
- **èµ„æºç®¡ç†**: è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- **é”™è¯¯å¤„ç†**: Resultç±»å‹å®‰å…¨å¤„ç†
- **å†…å­˜å®‰å…¨**: Rustæ‰€æœ‰æƒç³»ç»Ÿ

## ğŸ”§ æ‰©å±•å»ºè®®

1. **æ·»åŠ æ•°æ®åº“**: è§†é¢‘è®°å½•æŒä¹…åŒ–
2. **ç¼“å­˜æœºåˆ¶**: Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
3. **è´Ÿè½½å‡è¡¡**: å¤šå®ä¾‹éƒ¨ç½²
4. **ç›‘æ§å‘Šè­¦**: Prometheus + Grafana
5. **APIæ–‡æ¡£**: OpenAPI/Swaggeré›†æˆ 